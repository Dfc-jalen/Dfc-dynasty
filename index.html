<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.6.1/firebase-auth-compat.js"></script>

<script>
  // ------------------ Firebase Setup ------------------
  const firebaseConfig = {
    apiKey: "AIzaSyCLBNPDxjTLE9DqECxyOW2DKW1zjDd2cic",
    authDomain: "dfcdynasty.firebaseapp.com",
    projectId: "dfcdynasty",
    storageBucket: "dfcdynasty.firebasestorage.app",
    messagingSenderId: "554196354924",
    appId: "1:554196354924:web:46cd13b6a3490f32d15549",
    measurementId: "G-F9FET41Z8W"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  // ------------------ Auth Modal ------------------
  let authMode = 'signup';

  function toggleMobileMenu() {
    document.getElementById('mobileMenu').classList.toggle('hidden');
  }

  function showAuth(mode) {
    authMode = mode;
    document.getElementById('authModal').classList.remove('hidden');
    updateAuthModal();
  }

  function closeAuth() {
    document.getElementById('authModal').classList.add('hidden');
  }

  function toggleAuthMode() {
    authMode = authMode === 'signup' ? 'login' : 'signup';
    updateAuthModal();
  }

  function updateAuthModal() {
    if (authMode === 'signup') {
      document.getElementById('authTitle').textContent = 'Create Account';
      document.getElementById('authButton').textContent = 'Sign Up - Free';
      document.getElementById('authSwitch').textContent = 'Already have an account?';
      document.getElementById('authToggle').textContent = 'Login';
    } else {
      document.getElementById('authTitle').textContent = 'Login';
      document.getElementById('authButton').textContent = 'Login';
      document.getElementById('authSwitch').textContent = "Don't have an account?";
      document.getElementById('authToggle').textContent = 'Sign Up';
    }
  }

  // ------------------ Handle Auth ------------------
  async function handleAuth(event) {
    event.preventDefault();
    const form = event.target;
    const email = form.querySelector('input[type="email"]').value;
    const password = form.querySelector('input[type="password"]').value;

    try {
      let userCredential;
      if (authMode === 'signup') {
        userCredential = await auth.createUserWithEmailAndPassword(email, password);
        alert('ðŸŽ‰ Account created! Free content unlocked!');
      } else {
        userCredential = await auth.signInWithEmailAndPassword(email, password);
        alert('âœ… Logged in successfully! Free content unlocked!');
      }
      closeAuth();
      form.reset();
      unlockContent();
    } catch (err) {
      alert('âŒ Error: ' + err.message);
    }
  }

  // ------------------ Auth State Listener ------------------
  auth.onAuthStateChanged(user => {
    if (user) unlockContent();
  });

  // ------------------ Unlock Content ------------------
  function unlockContent() {
    // Hide all "Sign Up to Access" buttons
    document.querySelectorAll('button[onclick="showAuth(\'signup\')"]').forEach(btn => btn.style.display = 'none');
  }

  // ------------------ Premium / Voucher ------------------
  function purchasePremium() {
    alert('ðŸŽ‰ Premium Access Purchased!\n\nâœ… Your Premium Content is Now Unlocked!\n\nðŸ“± NEXT STEP - Get Your Discord Role:\n1. Join our Discord: https://discord.gg/JYMTyK6TbR\n2. Go to the #verification channel\n3. Submit your purchase confirmation\n4. You\'ll receive the "eBook Member" role\n5. Access exclusive private channels!\n\nAll premium schemes are now unlocked!');
  }

  function redeemVoucher() {
    const code = document.getElementById('voucherInput').value.toUpperCase();
    const error = document.getElementById('voucherError');

    if (code === 'DFC5') {
      alert('ðŸŽ‰ Voucher Code Accepted! Welcome Back!\n\nâœ… Your Premium Content is Now Unlocked!');
      document.getElementById('voucherInput').value = '';
      error.classList.add('hidden');
    } else {
      error.classList.remove('hidden');
    }
  }

  // ------------------ Smooth Scroll ------------------
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function(e) {
      e.preventDefault();
      const target = document.querySelector(this.getAttribute('href'));
      if (target) target.scrollIntoView({ behavior: 'smooth' });
      document.getElementById('mobileMenu').classList.add('hidden');
    });
  });

  // ------------------ Demo unlock for testing ------------------
  window.addEventListener('DOMContentLoaded', () => {
    console.log('Firebase initialized, page loaded');
  });
</script>
